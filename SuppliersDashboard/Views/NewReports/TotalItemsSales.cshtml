@using SuppliersDashboard.Resources
@{
    ViewBag.Title = "TotalItemsSales";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}

<div class="text-center ">

    <div class="row">
        <div class="col-lg-3"></div>
        <input type="hidden" id="hiddenItemIdInput" value="0" />
        <div class="col-lg-6">
            <input list="itemslistoption" name="itemslistoption" class="form-control" placeholder="اختار صنف" id="ItemIdInput" />
            <datalist id="itemslistoption">
            </datalist>


        </div>
        <div class="col-lg-3"></div>

    </div>
    <div class="row d-flex justify-content-around">
        <div class="col-lg-6 d-flex justify-content-around">
            <div class="col-lg-4 text-center p-3">@pages.iin </div>
            <div class="col-lg-8 text-center p-3">
                <input class="form-control" type="date" id="DateFrom" />
            </div>
        </div>
        <div class="col-lg-6 d-flex justify-content-around">
            <div class="col-lg-4 text-center p-3"> @pages.from </div>
            <div class="col-lg-8 text-center p-3">
                <input class="form-control" type="date" id="DateTo" />
            </div>
        </div>
    </div>
</div>

<div class="collapse show" id="userMsg">
    <div class="alert alert-warning text-center" role="alert">
        من فضلك . . . اختر صنف
    </div>
</div>

<div id="printer" class="collapse">
    <style>
        td, th {
            text-align: center !important;
            border: 1px solid #000 !important;
        }

        table {
            border-collapse: collapse !important;
        }
    </style>





    @*header1 *@
    <div class="row">
        <div class="col-12 justify-content-center ">
            <h2 class="h2 text-primary text-center m-3 " id="header"> </h2>
        </div>
        <div class="col-12" style="height:30px"></div>
    </div>


    @*table1*@
    <div class=" card-ERB ">
        <div class="  table-responsive  ">

            <div id="tablecollapse ">
                <table class="table table-bordered table-striped" id="table">
                    <thead>
                        <tr>
                            <th>
                                #
                            </th>
                            <th>
                                @Items.ItemName
                            </th>
                            <th>
                                @pages.quantity
                            </th>
                            <th>
                                @pages.priceun
                            </th>
                            <th>
                                @llayout.pricetotel
                            </th>
                            <th>
                                @pages.pricepr
                            </th>

                        </tr>
                    </thead>
                    <tbody id="tablebody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    @*header2*@
    <div class="row">
        <div class="col-12 justify-content-center ">
            <h2 class="h2 text-primary text-center m-3 " id="header2"> </h2>
        </div>
        <div class="col-12" style="height:30px"></div>
    </div>
    <div class=" card-ERB ">
        <div class="  table-responsive  ">

            <div id="tablecollapse ">
                @*table2*@
                <table class="table table-bordered table-striped" id="table2">
                    <thead>
                        <tr>
                            <th>
                                #
                            </th>
                            <th>
                                @llayout.NameSalesMan
                            </th>
                            <th>
                                @Items.ItemName
                            </th>
                            <th>
                                @pages.quantity
                            </th>
                            <th>
                                @pages.priceun
                            </th>
                            <th>
                                @llayout.pricetotel
                            </th>
                            <th>
                                @pages.pricepr
                            </th>

                        </tr>
                    </thead>
                    <tbody id="tablebody2">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    @*header 3*@
    <div class="row">
        <div class="col-12 justify-content-center ">
            <h2 class="h2 text-primary text-center m-3 " id="header3"> </h2>
        </div>
        <div class="col-12" style="height:30px"></div>
    </div>

    <div class=" card-ERB ">
        <div class="table-responsive  ">

            <div id="tablecollapse ">
                @*table3*@
                <table class="table table-bordered table-striped" id="table3">
                    <thead>
                        <tr>
                            <th>
                                #
                            </th>
                            <th>
                                @llayout.Branch
                            </th>
                            <th>
                                @Items.ItemName
                            </th>
                            <th>
                                @pages.quantity
                            </th>
                            <th>
                                @pages.priceun
                            </th>
                            <th>
                                @llayout.pricetotel
                            </th>
                            <th>
                                @pages.pricepr
                            </th>

                        </tr>
                    </thead>
                    <tbody id="tablebody3">
                    </tbody>
                </table>



            </div>
        </div>
    </div>
<div class="row d-flex justify-content-around">

    <div class="col-lg-4 text-center p-3">
        <button class="btn btn-primary col-12 btn-lg" onclick="Print()"><i class="fa fa-solid fa-print" id="printbtn"></i> @llayout.print</button>
    </div>
    <div class="col-lg-4 text-center p-3">

        <button class="btn btn-primary col-12 btn-lg " onclick="excel()" id="excelbtn">@llayout.Execl </button>

    </div>

</div>
@*<div class="row d-flex justify-content-around">

    <div class="col-lg-4 text-center p-3">
        <button class="btn btn-primary col-12 btn-lg" onclick="Print()"><i class="fa fa-solid fa-print" id="printbtn"></i> @llayout.print</button>
    </div>
    <div class="col-lg-4 text-center p-3">

        <button class="btn btn-primary col-12 btn-lg " onclick="excel()" id="excelbtn">@llayout.Execl </button>

    </div>

</div>*@

@*<div class="text-center p-4 collapse" id="btnsDiv">
        <button class="btn btn-outline-danger" onclick="Print()"><i class="fa fa-solid fa-print" id="printbtn"></i> @llayout.print</button>
        <span style="width:20px"> </span>
        <button class="btn btn-outline-success" onclick="excel()" id="excelbtn">@llayout.Execl </button>
    </div>*@
<input type="hidden" id="twice" value="0" />



<script>

    $(document).ready(function () {
        $("#DateFrom").change(() => {
            LoadPage($("#hiddenItemIdInput").val(), $("#DateFrom").val(), $("#DateTo").val())

        })
        $("#DateTo").change(() => {
            LoadPage($("#hiddenItemIdInput").val(), $("#DateFrom").val(), $("#DateTo").val())
        })
        $("#ItemIdInput").change(() => {
            let id = $("#ItemIdInput").val();
            $("#hiddenItemIdInput").val(id)


            LoadPage(id, $("#DateFrom").val(), $("#DateTo").val())

            let name = $('#itemslistoption option[value="' + id + '"]').text()
            $("#ItemIdInput").attr("placeholder", name)
            $("#ItemIdInput").val("")


        })

    })
    let currentdate = new Date();

    let m = currentdate.getMonth() + 1;
    if (m < 10) m = "0" + m
    let d = currentdate.getDate();
    if (d < 10) d = "0" + d
    let dd = "" + currentdate.getFullYear() + "-" + m + "-" + d
    $("#DateFrom").val(dd)
    $("#DateTo").val(dd)
    //LoadPage(0,dd,dd)
    function excel() {

        let datefrom = $("#DateFrom").val()
        let dateto = $("#DateTo").val()

        let ItemID = $("#hiddenItemIdInput").val()

        let h = $("#header").text()
        LayoutExcel(`/Report/ItemSalesFromToExcel?ItemId=${ItemID}&DateFrom=${datefrom}&DateTo=${dateto}`, `${h}`)
    }


    $.ajax({
        url: "/Items/GetAllItemsFromTable",
        type: "post",
        data: {

        }, success: (res) => {

            let html;
            $.each(res.data.Data, (i, e) => {
                html += `<option value='${e.Record_ID}'> ${e.ItemName}</option>`
            })
            $("#itemslistoption").html(html)
        }
    })


    function LoadPage(ItemID, DateFrom, DateTo) {

        if ($("#ItemIdInput").val() != 0) {
            $("#printer").collapse("show");
            $("#btnsDiv").collapse("show");
            $("#userMsg").collapse("hide");


        }

        if (ItemID == "") {
            ItemID = 0
        }
        //$("#spinner").addClass("show");
        startloader()
        setTimeout(() => {
            endloader()
        }, 3000)
        //if (ItemID <= 0) {
        //    ShowModal(`<h2 class='text-center'> من افضلك اختر صنف صحيح </h2>`)
        //}
        $.ajax({
            url: "/NewReports/TotalItemsSalesJSON",
            type: "post",
            data: {
                ItemID: ItemID,
                DateFrom: DateFrom,
                DateTo: DateTo
            }, success: (res) => {
                console.log(res)
                endloader()

                $("#header").text(res.data.Message)

                let ciunter = 1;


                $("#table").dataTable({
                    'iDisplayLength': 25,
                    "bDestroy": true,
                    "bSearchable": true,
                    "responsive": true,
                    "language": {
                        "searchPlaceholder": 'Search...',
                        "sSearch": '',
                        "lengthMenu": '_MENU_ items/page',
                    },
                    data: res.data.Data,
                    "columns": [
                        {
                            "data": null, render: function () {
                                return ciunter++
                            }
                        },
                        { "data": "Items", "name": "Items", "width": "Auto" },
                        { "data": "NumberOfUnits", "name": "NumberOfUnits", "width": "Auto" },
                        { "data": "UnitPrice", "name": "UnitPrice", "width": "Auto" },
                        { "data": "TotalPrice", "name": "TotalPrice", "width": "Auto" },
                        { "data": "DefaultTotalPrice", "name": "Average", "width": "Auto" },


                    ]
                })



                //header/table 2
                $("#header2").text(res.data.Message2)

                let ciunter2 = 1;


                $("#table2").dataTable({
                    'iDisplayLength': 25,
                    "bDestroy": true,
                    "bSearchable": true,
                    "responsive": true,
                    "language": {
                        "searchPlaceholder": 'Search...',
                        "sSearch": '',
                        "lengthMenu": '_MENU_ items/page',
                    },
                    data: res.data.Data2,
                    "columns": [
                        {
                            "data": null, render: function () {
                                return ciunter2++
                            }
                        },
                        { "data": "UserName", "name": "UserName", "width": "Auto" },
                        { "data": "Items", "name": "Items", "width": "Auto" },
                        { "data": "NumberOfUnits", "name": "NumberOfUnits", "width": "Auto" },
                        { "data": "UnitPrice", "name": "UnitPrice", "width": "Auto" },
                        { "data": "TotalPrice", "name": "TotalPrice", "width": "Auto" },
                        { "data": "DefaultTotalPrice", "name": "Average", "width": "Auto" },



                    ]
                })





                /*Header/table3*/
                $("#header3").text(res.data.Message3)

                let ciunter3 = 1;


                $("#table3").dataTable({
                    'iDisplayLength': 25,
                    "bDestroy": true,
                    "bSearchable": true,
                    "responsive": true,
                    "language": {
                        "searchPlaceholder": 'Search...',
                        "sSearch": '',
                        "lengthMenu": '_MENU_ items/page',
                    },
                    data: res.data.Data3,
                    "columns": [
                        {
                            "data": null, render: function () {
                                return ciunter3++
                            }
                        },
                        { "data": "BranchName", "name": "BranchName", "width": "Auto" },
                        { "data": "Items", "name": "Items", "width": "Auto" },
                        { "data": "NumberOfUnits", "name": "NumberOfUnits", "width": "Auto" },
                        { "data": "UnitPrice", "name": "UnitPrice", "width": "Auto" },
                        { "data": "TotalPrice", "name": "TotalPrice", "width": "Auto" },
                        { "data": "DefaultTotalPrice", "name": "Average", "width": "Auto" },

                    ]
                })


            }

        })
        $("#spinner").removeClass("show");

    }
    function Print() {
        $("#Table_length").addClass("d-none")
        $("#Table_paginate").addClass("d-none")
        $("#Table_filter").addClass("d-none")
        $("#Table_info").addClass("d-none")
        $("#table_length").addClass("d-none")
        $("#table_paginate").addClass("d-none")
        $("#table_filter").addClass("d-none")
        $("#table_info").addClass("d-none")
        let df = $("#DateFrom").val()
        let dt = $("#DateTo").val()
        //var restorepage = $('body').html();
        //var printcontent = $('#printer').clone();

        //$('body').empty().html(printcontent);
        //window.print();
        LayoutPrint()
        //   $('body').html(restorepage);
        $("#DateFrom").val(df)
        $("#DateTo").val(dt)

    }
    function endloader() {
        $("#spinner").removeClass("show");
    }
    function ShowModal(html) {
        $("#modalcontent").html(html)
        $("#myModal").modal("show")
    }
    function startloader() {
        $("#spinner").addClass("show");
    }

</script>
